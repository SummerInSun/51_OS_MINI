C51 COMPILER V9.02   EEPROM                                                                01/31/2016 12:31:26 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE EEPROM
OBJECT MODULE PLACED IN .\eeprom.obj
COMPILER INVOKED BY: D:\Program Files\keil4\C51\BIN\C51.EXE ..\src\eeprom.c BROWSE INCDIR(..\head) DEBUG OBJECTEXTEND PR
                    -INT(.\eeprom.lst) OBJECT(.\eeprom.obj)

line level    source

   1          #include <eeprom.h>
   2          #include <common.h>
   3          
   4          /*****************************************
   5           * EEPROM写入数据
   6           * 例:iap_write(10,'A'); 向地址为10的EEPROM写入数据A
   7           *****************************************/
   8          void iap_write(uint address, uchar wdata)
   9          {
  10   1              clear_iap;
  11   1              if(!check_iap)                                          //判断电压是否满足需求
  12   1              {
  13   2                      IAP_CONTR = 0x80;                               //使能
  14   2                      IAP_CMD   = CMD_WRITE;          //选择命令为‘写命令’
  15   2                      IAP_ADDRH = address >> 8;               //写地址高位
  16   2                      IAP_ADDRL = address;                //写地址低位
  17   2              
  18   2                      IAP_DATA  = wdata;
  19   2                      IAP_TRIG=0x5A;IAP_TRIG=0XA5;
  20   2                      _nop_();_nop_();                                //触发操作，写入数据
  21   2      
  22   2              }
  23   1      }
  24          
  25          /*****************************************
  26           * EEPROM读出数据
  27           * 例:dat = iap_read(10); 读地址为10的EEPROM存入dat
  28           *****************************************/
  29          uchar iap_read(uint address)
  30          {
  31   1              uchar rdata;
  32   1      
  33   1              clear_iap;
  34   1              if(!check_iap)                          //判断电压是否满足需求
  35   1              {
  36   2                      IAP_CONTR = 0x80;                               //使能
  37   2                      IAP_CMD   = CMD_READ;           //选择命令为‘写命令’
  38   2                      IAP_ADDRH = address >> 8;               //写地址高位
  39   2                      IAP_ADDRL = address;                //写地址低位
  40   2                      
  41   2                      IAP_TRIG=0x5A;IAP_TRIG=0XA5;
  42   2                      _nop_();_nop_();                                //触发操作，触发读入数据
  43   2                      rdata     = IAP_DATA;
  44   2      
  45   2              }
  46   1      
  47   1              return rdata;
  48   1      }
  49          
  50          /*****************************************
  51           * EEPROM擦除数据
  52           * 例:iap_read(0); 擦除EEPROM数据
  53           *****************************************/
  54          void iap_erase(uint address)
C51 COMPILER V9.02   EEPROM                                                                01/31/2016 12:31:26 PAGE 2   

  55          {
  56   1              clear_iap;
  57   1              if(!check_iap)                                          //判断电压是否满足需求
  58   1              {
  59   2                      IAP_CONTR = 0x80;                               //使能
  60   2                      IAP_CMD   = CMD_ERASE;          //选择命令为‘写命令’
  61   2                      IAP_ADDRH = address / 256;              //写地址高位
  62   2                      IAP_ADDRL = address % 256;              //写地址低位
  63   2                      
  64   2                      IAP_TRIG=0x5A;IAP_TRIG=0XA5;
  65   2                      _nop_();_nop_();                                //触发操作，触发擦除数据
  66   2      
  67   2              }
  68   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    101    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
