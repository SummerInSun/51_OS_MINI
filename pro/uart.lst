C51 COMPILER V9.02   UART                                                                  01/31/2016 12:31:26 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\uart.obj
COMPILER INVOKED BY: D:\Program Files\keil4\C51\BIN\C51.EXE ..\src\uart.c BROWSE INCDIR(..\head) DEBUG OBJECTEXTEND PRIN
                    -T(.\uart.lst) OBJECT(.\uart.obj)

line level    source

   1          #include <uart.h>
   2          
   3          /*****************************************
   4           *独立波特率发生器串口初始化
   5           *例:uart_bart(38400);  初始化串口波特率38400 
   6           *32M晶振专用
   7           *****************************************/
   8          void uart_bart(uint baud)
   9          {
  10   1              SCON |= 0x50;          //REN置位为1，允许接收，SM1 = 0；SM0 = 1；
  11   1              //串口1工作在方式1，八位可变波特率
  12   1              AUXR |= 0x05;              //独立波特率发生器做串口1时钟源
  13   1              AUXR |= (1 << 4);      //允许独立波特率发生器运行(开启独立波特率发生器)
  14   1      
  15   1              if(baud > 115200)
  16   1              {
  17   2                      BRT = 0xF7;
  18   2              }
  19   1              else if(baud < 4800)
  20   1              {
  21   2                      BRT = 0x30;
  22   2              }
  23   1              else
  24   1                      BRT       = 256 - (1000000 / baud  + 1);
  25   1      
  26   1              EA = 1;                //开全局中断
  27   1      //      ES = 1;                            //开总中断
  28   1      }
  29          
  30          /*****************************************
  31           *独立波特率发生器串口初始化
  32           *例:uart_bart(38400);  初始化串口波特率38400 
  33           *11.0592M晶振专用
  34           *****************************************/
  35          void uart_bart11(uint baud)
  36          {
  37   1              SCON |= 0x50;          //REN置位为1，允许接收，SM1 = 0；SM0 = 1；
  38   1              //串口1工作在方式1，八位可变波特率
  39   1              AUXR |= 0x05;              //独立波特率发生器做串口1时钟源
  40   1              AUXR |= (1 << 4);      //允许独立波特率发生器运行(开启独立波特率发生器)
  41   1      
  42   1              if(baud > 38400)
  43   1              {
  44   2                      BRT = 256 - 345600 / 38400 / 2;
  45   2              }
  46   1              else if(baud < 2400)
  47   1              {
  48   2                      BRT = 256 - 345600 / 2400 / 2;
  49   2              }
  50   1              else
  51   1                      BRT       = 256 - 345600 / baud / 2;
  52   1      
  53   1              EA = 1;                //开全局中断
  54   1      //      ES = 1;                            //开总中断
C51 COMPILER V9.02   UART                                                                  01/31/2016 12:31:26 PAGE 2   

  55   1      }
  56          
  57          /*****************************************
  58           *串口发送一个字节
  59           *例:uart_send_byte('A');  发送字符A
  60           *****************************************/
  61          void uart_send_byte(uchar tx_data)
  62          {
  63   1              SBUF = tx_data;
  64   1              while(!TI);
  65   1              TI = 0;
  66   1      }
  67          
  68          /*****************************************
  69           *串口发送一个字符串
  70           *例:uart_send_str("www.bohen.com");  发送字符串www.bohen.com
  71           *****************************************/
  72          void uart_send_str(uchar* str)
  73          {
  74   1              while(*str)
  75   1              {
  76   2                      uart_send_byte(*str ++);
  77   2              }
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    217    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
